var fe=t=>{throw TypeError(t)};var X=(t,e,s)=>e.has(t)||fe("Cannot "+s);var i=(t,e,s)=>(X(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),g=(t,e,s,r)=>(X(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),x=(t,e,s)=>(X(t,e,"access private method"),s);import{S as we,p as pe,a as O,s as Z,b as H,n as q,i as ee,c as ge,d as Ne,f as Ee,e as Oe,g as xe,h as je,k as me,l as Se,m as Ie,r as w,o as Qe,u as Fe,j as a}from"./index.js";import{C as Te,a as _e,b as Me,c as De,d as Le,e as Ue}from"./card.js";import"./utils.js";var R,c,$,y,T,L,I,Q,z,U,k,_,M,F,A,l,B,te,se,ie,re,ae,ne,oe,Ce,Re,ke=(Re=class extends we{constructor(e,s){super();b(this,l);b(this,R);b(this,c);b(this,$);b(this,y);b(this,T);b(this,L);b(this,I);b(this,Q);b(this,z);b(this,U);b(this,k);b(this,_);b(this,M);b(this,F);b(this,A,new Set);this.options=s,g(this,R,e),g(this,Q,null),g(this,I,pe()),this.options.experimental_prefetchInRender||i(this,I).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,c).addObserver(this),be(i(this,c),this.options)?x(this,l,B).call(this):this.updateResult(),x(this,l,re).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ce(i(this,c),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ce(i(this,c),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,x(this,l,ae).call(this),x(this,l,ne).call(this),i(this,c).removeObserver(this)}setOptions(e){const s=this.options,r=i(this,c);if(this.options=i(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof O(this.options.enabled,i(this,c))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");x(this,l,oe).call(this),i(this,c).setOptions(this.options),s._defaulted&&!Z(this.options,s)&&i(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,c),observer:this});const u=this.hasListeners();u&&ve(i(this,c),r,this.options,s)&&x(this,l,B).call(this),this.updateResult(),u&&(i(this,c)!==r||O(this.options.enabled,i(this,c))!==O(s.enabled,i(this,c))||H(this.options.staleTime,i(this,c))!==H(s.staleTime,i(this,c)))&&x(this,l,te).call(this);const h=x(this,l,se).call(this);u&&(i(this,c)!==r||O(this.options.enabled,i(this,c))!==O(s.enabled,i(this,c))||h!==i(this,F))&&x(this,l,ie).call(this,h)}getOptimisticResult(e){const s=i(this,R).getQueryCache().build(i(this,R),e),r=this.createResult(s,e);return Be(this,r)&&(g(this,y,r),g(this,L,this.options),g(this,T,i(this,c).state)),r}getCurrentResult(){return i(this,y)}trackResult(e,s){return new Proxy(e,{get:(r,u)=>(this.trackProp(u),s==null||s(u),Reflect.get(r,u))})}trackProp(e){i(this,A).add(e)}getCurrentQuery(){return i(this,c)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,R).defaultQueryOptions(e),r=i(this,R).getQueryCache().build(i(this,R),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return x(this,l,B).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,y)))}createResult(e,s){var de;const r=i(this,c),u=this.options,h=i(this,y),o=i(this,T),N=i(this,L),m=e!==r?e.state:i(this,$),{state:C}=e;let d={...C},E=!1,p;if(s._optimisticResults){const P=this.hasListeners(),W=!P&&be(e,s),D=P&&ve(e,r,s,u);(W||D)&&(d={...d,...Oe(C.data,e.options)}),s._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:n,errorUpdatedAt:j,status:v}=d;p=d.data;let V=!1;if(s.placeholderData!==void 0&&p===void 0&&v==="pending"){let P;h!=null&&h.isPlaceholderData&&s.placeholderData===(N==null?void 0:N.placeholderData)?(P=h.data,V=!0):P=typeof s.placeholderData=="function"?s.placeholderData((de=i(this,k))==null?void 0:de.state.data,i(this,k)):s.placeholderData,P!==void 0&&(v="success",p=xe(h==null?void 0:h.data,P,s),E=!0)}if(s.select&&p!==void 0&&!V)if(h&&p===(o==null?void 0:o.data)&&s.select===i(this,z))p=i(this,U);else try{g(this,z,s.select),p=s.select(p),p=xe(h==null?void 0:h.data,p,s),g(this,U,p),g(this,Q,null)}catch(P){g(this,Q,P)}i(this,Q)&&(n=i(this,Q),p=i(this,U),j=Date.now(),v="error");const K=d.fetchStatus==="fetching",G=v==="pending",J=v==="error",le=G&&K,ue=p!==void 0,S={status:v,fetchStatus:d.fetchStatus,isPending:G,isSuccess:v==="success",isError:J,isInitialLoading:le,isLoading:le,data:p,dataUpdatedAt:d.dataUpdatedAt,error:n,errorUpdatedAt:j,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>m.dataUpdateCount||d.errorUpdateCount>m.errorUpdateCount,isFetching:K,isRefetching:K&&!G,isLoadingError:J&&!ue,isPaused:d.fetchStatus==="paused",isPlaceholderData:E,isRefetchError:J&&ue,isStale:he(e,s),refetch:this.refetch,promise:i(this,I),isEnabled:O(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const P=Y=>{S.status==="error"?Y.reject(S.error):S.data!==void 0&&Y.resolve(S.data)},W=()=>{const Y=g(this,I,S.promise=pe());P(Y)},D=i(this,I);switch(D.status){case"pending":e.queryHash===r.queryHash&&P(D);break;case"fulfilled":(S.status==="error"||S.data!==D.value)&&W();break;case"rejected":(S.status!=="error"||S.error!==D.reason)&&W();break}}return S}updateResult(){const e=i(this,y),s=this.createResult(i(this,c),this.options);if(g(this,T,i(this,c).state),g(this,L,this.options),i(this,T).data!==void 0&&g(this,k,i(this,c)),Z(s,e))return;g(this,y,s);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:u}=this.options,h=typeof u=="function"?u():u;if(h==="all"||!h&&!i(this,A).size)return!0;const o=new Set(h??i(this,A));return this.options.throwOnError&&o.add("error"),Object.keys(i(this,y)).some(N=>{const f=N;return i(this,y)[f]!==e[f]&&o.has(f)})};x(this,l,Ce).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&x(this,l,re).call(this)}},R=new WeakMap,c=new WeakMap,$=new WeakMap,y=new WeakMap,T=new WeakMap,L=new WeakMap,I=new WeakMap,Q=new WeakMap,z=new WeakMap,U=new WeakMap,k=new WeakMap,_=new WeakMap,M=new WeakMap,F=new WeakMap,A=new WeakMap,l=new WeakSet,B=function(e){x(this,l,oe).call(this);let s=i(this,c).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(q)),s},te=function(){x(this,l,ae).call(this);const e=H(this.options.staleTime,i(this,c));if(ee||i(this,y).isStale||!ge(e))return;const r=Ne(i(this,y).dataUpdatedAt,e)+1;g(this,_,setTimeout(()=>{i(this,y).isStale||this.updateResult()},r))},se=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,c)):this.options.refetchInterval)??!1},ie=function(e){x(this,l,ne).call(this),g(this,F,e),!(ee||O(this.options.enabled,i(this,c))===!1||!ge(i(this,F))||i(this,F)===0)&&g(this,M,setInterval(()=>{(this.options.refetchIntervalInBackground||Ee.isFocused())&&x(this,l,B).call(this)},i(this,F)))},re=function(){x(this,l,te).call(this),x(this,l,ie).call(this,x(this,l,se).call(this))},ae=function(){i(this,_)&&(clearTimeout(i(this,_)),g(this,_,void 0))},ne=function(){i(this,M)&&(clearInterval(i(this,M)),g(this,M,void 0))},oe=function(){const e=i(this,R).getQueryCache().build(i(this,R),this.options);if(e===i(this,c))return;const s=i(this,c);g(this,c,e),g(this,$,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ce=function(e){je.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,y))}),i(this,R).getQueryCache().notify({query:i(this,c),type:"observerResultsUpdated"})})},Re);function Ae(t,e){return O(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function be(t,e){return Ae(t,e)||t.state.data!==void 0&&ce(t,e,e.refetchOnMount)}function ce(t,e,s){if(O(e.enabled,t)!==!1&&H(e.staleTime,t)!=="static"){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&he(t,e)}return!1}function ve(t,e,s,r){return(t!==e||O(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&he(t,s)}function he(t,e){return O(e.enabled,t)!==!1&&t.isStaleByTime(H(e.staleTime,t))}function Be(t,e){return!Z(t.getCurrentResult(),e)}var He=class extends ke{constructor(t,e){super(t,e)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:me()})}getOptimisticResult(t){return t.behavior=me(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,e){var n,j;const{state:s}=t,r=super.createResult(t,e),{isFetching:u,isRefetching:h,isError:o,isRefetchError:N}=r,f=(j=(n=s.fetchMeta)==null?void 0:n.fetchMore)==null?void 0:j.direction,m=o&&f==="forward",C=u&&f==="forward",d=o&&f==="backward",E=u&&f==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Ie(e,s.data),hasPreviousPage:Se(e,s.data),isFetchNextPageError:m,isFetchingNextPage:C,isFetchPreviousPageError:d,isFetchingPreviousPage:E,isRefetchError:N&&!m&&!d,isRefetching:h&&!C&&!E}}},Pe=w.createContext(!1),$e=()=>w.useContext(Pe);Pe.Provider;function ze(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ve=w.createContext(ze()),We=()=>w.useContext(Ve),Ye=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ke=t=>{w.useEffect(()=>{t.clearReset()},[t])},Ge=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:u})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(u&&t.data===void 0||Qe(s,[t.error,r])),Je=t=>{if(t.suspense){const e=r=>r==="static"?r:Math.max(r??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...r)=>e(s(...r)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Xe=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,ye=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function qe(t,e,s){var d,E,p,n,j;const r=$e(),u=We(),h=Fe(),o=h.defaultQueryOptions(t);(E=(d=h.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||E.call(d,o),o._optimisticResults=r?"isRestoring":"optimistic",Je(o),Ye(o,u),Ke(u);const N=!h.getQueryCache().get(o.queryHash),[f]=w.useState(()=>new e(h,o)),m=f.getOptimisticResult(o),C=!r&&t.subscribed!==!1;if(w.useSyncExternalStore(w.useCallback(v=>{const V=C?f.subscribe(je.batchCalls(v)):q;return f.updateResult(),V},[f,C]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),w.useEffect(()=>{f.setOptions(o)},[o,f]),Ze(o,m))throw ye(o,f,u);if(Ge({result:m,errorResetBoundary:u,throwOnError:o.throwOnError,query:h.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw m.error;if((n=(p=h.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||n.call(p,o,m),o.experimental_prefetchInRender&&!ee&&Xe(m,r)){const v=N?ye(o,f,u):(j=h.getQueryCache().get(o.queryHash))==null?void 0:j.promise;v==null||v.catch(q).finally(()=>{f.updateResult()})}return o.notifyOnChangeProps?m:f.trackResult(m)}function et(t,e){return qe(t,He)}function nt(){var E,p;const{data:t,isLoading:e,isError:s,error:r,fetchNextPage:u,hasNextPage:h,isFetchingNextPage:o,refetch:N,status:f}=et({queryKey:["/api/v1/daberton/roomtemplate"],queryFn:async({pageParam:n=1})=>(await Ue.get(`/api/v1/daberton/roomtemplate?page_size=5&page=${n}`)).data,initialPageParam:1,getNextPageParam:n=>{const j=n.pagination.page,v=n.pagination.total_pages;return j<v?j+1:void 0}}),m=((E=t==null?void 0:t.pages)==null?void 0:E.flatMap(n=>n.data))??[],C=w.useRef(null),d=w.useCallback(n=>{n[0].isIntersecting&&h&&!o&&u()},[u,h,o]);return w.useEffect(()=>{if(!C.current)return;const n=new IntersectionObserver(d,{root:null,rootMargin:"0px",threshold:1});return n.observe(C.current),()=>n.disconnect()},[d]),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Room Templates"}),a.jsx("div",{className:"flex gap-2",children:a.jsx("button",{onClick:()=>N(),className:"text-sm px-3 py-1 border rounded-md hover:bg-accent",children:"Refresh"})})]}),e&&a.jsx("div",{children:"Loading..."}),s&&a.jsxs("div",{className:"text-red-500 text-sm",children:["Error: ",r==null?void 0:r.message]}),f==="success"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m.map(n=>a.jsxs(Te,{children:[a.jsxs(_e,{children:[a.jsxs(Me,{className:"flex items-center justify-between",children:[a.jsx("span",{children:n.title||`#${n.id}`}),a.jsx("span",{className:"text-xs px-2 py-1 rounded-md border",children:n.game_style})]}),a.jsxs(De,{children:["ID: ",n.id]})]}),a.jsxs(Le,{className:"text-xs space-y-1",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Entry Fee"}),a.jsx("span",{children:n.entry_fee})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Players"}),a.jsxs("span",{children:[n.min_players," - ",n.max_players]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Timeout"}),a.jsx("span",{children:n.timeout})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Public"}),a.jsx("span",{children:n.is_public?"Yes":"No"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"System"}),a.jsx("span",{children:n.is_system?"Yes":"No"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Active"}),a.jsx("span",{children:n.is_active?"Yes":"No"})]})]})]},n.id))}),a.jsxs("div",{className:"flex flex-col items-center gap-2 pt-4",children:[!h&&m.length>0&&a.jsx("div",{className:"text-xs text-muted-foreground",children:"All pages loaded."}),h&&a.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading more when you reach the bottom..."}),o&&a.jsx("div",{className:"text-xs",children:"Loading next page..."}),h&&a.jsx("button",{onClick:()=>u(),disabled:o,className:"text-xs px-3 py-1 border rounded-md hover:bg-accent disabled:opacity-50",children:o?"Loading...":"Load more"}),a.jsx("div",{ref:C,className:"h-2 w-full"})]}),(p=t==null?void 0:t.pages)!=null&&p.length?a.jsx("div",{className:"text-xs text-muted-foreground",children:(()=>{const n=t.pages[t.pages.length-1];return`Page ${n.pagination.page} of ${n.pagination.total_pages} â€¢ Loaded ${m.length} / ${n.pagination.total_rows}`})()}):null]})]})}export{nt as default};
